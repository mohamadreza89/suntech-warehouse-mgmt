<?xml version="1.0" encoding="UTF-8"?>
<itop_design xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0">
  <constants>
  </constants>
  <classes>
    <class id="ProductCategory" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>product_categories</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="title" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="title" xsi:type="AttributeString">
          <sql>title</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="parent_id" xsi:type="AttributeHierarchicalKey">
          <filter><![CDATA[SELECT ProductCategory WHERE id != :this->id]]></filter>
          <sql>parent_id</sql>
          <target_class>ProductCategory</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
          <jointype/>
        </field>
        <field id="parent_title" xsi:type="AttributeExternalField">
          <extkey_attcode>parent_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="is_active" xsi:type="AttributeEnum">
          <values>
            <value id="1">1</value>
            <value id="0">0</value>
          </values>
          <sql>is_active</sql>
          <default_value>1</default_value>
          <is_null_allowed>true</is_null_allowed>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="parent_id">
              <rank>10</rank>
            </item>
            <item id="is_active">
              <rank>10</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="parent_id">
              <rank>10</rank>
            </item>
            <item id="is_active">
              <rank>10</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="parent_id">
              <rank>10</rank>
            </item>
            <item id="is_active">
              <rank>10</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods />
    </class>
    <class id="Product" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>products</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="title" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="title" xsi:type="AttributeString">
          <sql>title</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="technical_title" xsi:type="AttributeString">
          <sql>technical_title</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="product_category_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT ProductCategory]]></filter>
          <sql>product_category_id</sql>
          <target_class>ProductCategory</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="product_category_title" xsi:type="AttributeExternalField">
          <extkey_attcode>product_category_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="is_active" xsi:type="AttributeEnum">
          <values>
            <value id="1">1</value>
            <value id="0">0</value>
          </values>
          <sql>is_active</sql>
          <default_value>1</default_value>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="order_point" xsi:type="AttributeInteger">
          <sql>order_point</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="physical_device_type" xsi:type="AttributeString">
          <sql>physical_device_type</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="product_category_id">
              <rank>10</rank>
            </item>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="technical_title">
              <rank>20</rank>
            </item>
            <item id="is_active">
              <rank>30</rank>
            </item>
            <item id="order_point">
              <rank>40</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="product_category_id">
              <rank>10</rank>
            </item>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="technical_title">
              <rank>20</rank>
            </item>
            <item id="is_active">
              <rank>30</rank>
            </item>
            <item id="order_point">
              <rank>40</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="product_category_id">
              <rank>10</rank>
            </item>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="technical_title">
              <rank>20</rank>
            </item>
            <item id="is_active">
              <rank>30</rank>
            </item>
            <item id="order_point">
              <rank>40</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods>
        <method id="GetBareProperties">
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[ public function GetBareProperties(WebPage $oPage, $bEditMode = false, $sPrefix, $aExtraParams = array())
  {
    $aFieldsMap = parent::GetBareProperties($oPage, $bEditMode, $sPrefix, $aExtraParams);
    if ($bEditMode == true)
    {
      $oPage->add('<div class="field_container field_small">');
     
      $oPage->add('<span style="font-size:12px; font-weight:bold; margin-left:40px;">');
      $oPage->add(Dict::S('Class:Product/Attribute:physical_device_type'));
      $oPage->add('</span>');
      
      
      $oPage->add('<select name="physical_device_type">');
      $t = MetaModel::EnumChildClasses('PhysicalDevice');
      foreach ($t as $tt) {
        if (!MetaModel::IsAbstract($tt)){
          if ($this->Get('physical_device_type')==$tt)
          {
            $oPage->add('<option selected>'. $tt .'</option>');
            continue;
          }
          $oPage->add('<option value="'.$tt.'">'. Dict::S('Class:'.$tt) .'</option>');
        }
      }
      $oPage->add('</select>');
      
      $oPage->add('</div>');
    }
    if ($bEditMode == false)
    {
      $oPage->add('<div class="field_container field_small">');
      $oPage->add('<span style="font-size:12px; font-weight:bold; margin-left:40px;">');
     $oPage->add(Dict::S('Class:Product/Attribute:physical_device_type'));
     $oPage->add('</span>');
      $oPage->add(Dict::S('Class:'.$this->Get('physical_device_type')));
      $oPage->add('</div>');
    }

    return $aFieldsMap;
  }
            ]]></code>
        </method>

        <method id="UpdateObjectFromPostedForm">
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[ public function UpdateObjectFromPostedForm($sFormPrefix = '', $aAttList = null, $sTargetState = '')
  {
    
    $aErrors = parent::UpdateObjectFromPostedForm($sFormPrefix, $aAttList, $sTargetState);
    $physical_device = utils::ReadPostedParam('physical_device_type', '', 'raw_data');
    $this->Set('physical_device_type', $physical_device);
    
  }
            ]]></code>
        </method>

      </methods>
    </class>
    <class id="Inventory" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>inventory</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="title" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="title" xsi:type="AttributeString">
          <sql>title</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="width" xsi:type="AttributeInteger">
          <sql>width</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="height" xsi:type="AttributeInteger">
          <sql>height</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="depth" xsi:type="AttributeInteger">
          <sql>depth</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="width">
              <rank>20</rank>
            </item>
            <item id="height">
              <rank>30</rank>
            </item>
            <item id="depth">
              <rank>40</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="width">
              <rank>20</rank>
            </item>
            <item id="height">
              <rank>30</rank>
            </item>
            <item id="depth">
              <rank>40</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="width">
              <rank>20</rank>
            </item>
            <item id="height">
              <rank>30</rank>
            </item>
            <item id="depth">
              <rank>40</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods />
    </class>
    <class id="InventoryDetail" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>inventory_details</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="title" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="inventory_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Inventory]]></filter>
          <sql>inventory_id</sql>
          <target_class>Inventory</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="inventory_title" xsi:type="AttributeExternalField">
          <extkey_attcode>inventory_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="title" xsi:type="AttributeString">
          <sql>title</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="row" xsi:type="AttributeInteger">
          <sql>row</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="shelf" xsi:type="AttributeString">
          <sql>shelf</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="inventory_id">
              <rank>20</rank>
            </item>
            <item id="row">
              <rank>30</rank>
            </item>
            <item id="shelf">
              <rank>40</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="inventory_id">
              <rank>20</rank>
            </item>
            <item id="row">
              <rank>30</rank>
            </item>
            <item id="shelf">
              <rank>40</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
            <item id="inventory_id">
              <rank>20</rank>
            </item>
            <item id="row">
              <rank>30</rank>
            </item>
            <item id="shelf">
              <rank>40</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods />
    </class>

    <class id="FunctionalDocument" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>true</abstract>
        <key_type>autoincrement</key_type>
        <db_table>functional_documents</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="ref" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="ref" xsi:type="AttributeString">
          <sql>ref</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="created_at" xsi:type="AttributeDateTime">
          <always_load_in_tables>true</always_load_in_tables>
          <sql>created_at</sql>
          <default_value/>
          <is_null_allowed>true</is_null_allowed>
        </field>
        
        <field id="product_category_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT ProductCategory]]></filter>
          <sql>product_category_id</sql>
          <target_class>ProductCategory</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="product_category_title" xsi:type="AttributeExternalField">
          <extkey_attcode>product_category_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="product_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Product WHERE product_category_id = :this->product_category_id]]></filter>
          <dependencies>
            <attribute id="product_category_id"/>
          </dependencies>
          <sql>product_id</sql>
          <target_class>Product</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="product_title" xsi:type="AttributeExternalField">
          <extkey_attcode>product_id</extkey_attcode>
          <target_attcode>title</target_attcode>
        </field>
        <field id="product_technical_title" xsi:type="AttributeExternalField">
          <extkey_attcode>product_id</extkey_attcode>
          <target_attcode>technical_title</target_attcode>
        </field>
        <field id="physical_device_type" xsi:type="AttributeExternalField">
          <extkey_attcode>product_id</extkey_attcode>
          <target_attcode>physical_device_type</target_attcode>
        </field>
        <field id="balance" xsi:type="AttributeInteger">
          <sql>balance</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
      </fields>
      <methods>
        <method id="DBInsertNoReload">
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function OnInsert()
    {
      $this->Set('created_at', time());
      $iNextId = MetaModel::GetNextKey(get_class($this));
      if ($this->Get('ref') == '')
      {
        $this->Set('ref' , 'FD-'.sprintf('%06d', $iNextId));
      }
      
      parent::OnInsert();
    }
  ]]></code>
        </method>
        <method id="CheckToDelete">
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[   public function CheckToDelete(&$oDeletionPlan)
      {

      $iKey = $this->Get('id');
      $iProductID = $this->Get('product_id');

      $oFilter = DBObjectSearch::FromOQL('SELECT FunctionalDocument WHERE product_id='.$iProductID);
  
      $oFilter->AllowAllData();
      
      $oSet = new DBObjectSet($oFilter);
      $iLastKey = 0;
      while ($oObject = $oSet->Fetch())
      {
        if ($iLastKey < $oObject->Get('id'))
        {
          $iLastKey = $oObject->Get('id');
        }
      }

      if ($iKey != $iLastKey)
      {
        $oDeletionPlan->AddToDelete($this, null);
        $oDeletionPlan->SetDeletionIssues($this, array('Deletion is not allowed because the current record is not the last one'), true);
        $oDeletionPlan->ComputeResults();
        return false;
      }

      return parent::CheckToDelete($oDeletionPlan);
      }
]]></code>
        </method>
        <method id="onDelete">
          <static>false</static>
          <access>public</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[   public function onDelete()
      {


        
      }
]]></code>
        </method>
      </methods>
      <presentation>
        <details>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </details>
        <list>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </list>
        <search>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </search>
      </presentation>
    </class>



    <class id="WarehouseDocument" _delta="define">
      <parent>FunctionalDocument</parent>
      <properties>
        <comment><![CDATA[/**
 * Persistent classes for a CMDB
 *
 * @copyright   Copyright (C) 2010-2017 Combodo SARL
 * @license     http://opensource.org/licenses/AGPL-3.0
 */]]></comment>
        <category>bizmodel,searchable,structure</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>warehouse_document</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field>finalclass</db_final_class_field>
        <naming>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </naming>
        <reconciliation>
          <attributes>
            <attribute id="ref" />
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="vendor" xsi:type="AttributeExternalKey">
          <sql>vendor</sql>
          <target_class>ThirdParty</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="invoice_serial" xsi:type="AttributeString">
          <sql>invoice_serial</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="invoice_date" xsi:type="AttributeDate">
          <sql>invoice_date</sql>
          <default_value />
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="warranty" xsi:type="AttributeExternalKey">
          <sql>warranty</sql>
          <target_class>Warranty</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="end_of_warranty" xsi:type="AttributeDate">
          <always_load_in_tables>true</always_load_in_tables>
          <sql>end_of_warranty</sql>
          <default_value/>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="org_id" xsi:type="AttributeExternalKey">
          <sql>org_id</sql>
          <target_class>Organization</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="org_name" xsi:type="AttributeExternalField">
          <extkey_attcode>org_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
        <field id="caller_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Person WHERE org_id = :this->org_id]]></filter>
          <dependencies>
            <attribute id="org_id"/>
          </dependencies>
          <sql>caller_id</sql>
          <target_class>Person</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="caller_name" xsi:type="AttributeExternalField">
          <extkey_attcode>caller_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
        <field id="count" xsi:type="AttributeInteger">
          <sql>count</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
        <field id="inventory_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Inventory]]></filter>
          <sql>inventory_id</sql>
          <target_class>Inventory</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="inventory_title" xsi:type="AttributeExternalField">
          <extkey_attcode>inventory_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="inventory_detail_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT InventoryDetail WHERE inventory_id = :this->inventory_id]]></filter>
          <dependencies>
            <attribute id="inventory_id"/>
          </dependencies>
          <sql>inventory_detail_id</sql>
          <target_class>InventoryDetail</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="inventory_detail_title" xsi:type="AttributeExternalField">
          <extkey_attcode>inventory_detail_id</extkey_attcode>
          <target_attcode>title</target_attcode>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="physical_device_list" xsi:type="AttributeLinkedSetIndirect">
          <linked_class>lnkWarehouseDocToPhysicalDevice</linked_class>
          <ext_key_to_me>warehouse_document_id</ext_key_to_me>
          <count_min>0</count_min>
          <count_max>0</count_max>
          <ext_key_to_remote>physical_device_id</ext_key_to_remote>
          <duplicates/>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="fieldset:WarehouseDocument:baseInfo">
              <rank>10</rank>
              <items>
                <item id="vendor">
                  <rank>10</rank>
                </item>
                <item id="invoice_serial">
                  <rank>20</rank>
                </item>
                <item id="invoice_date">
                  <rank>30</rank>
                </item>
                <item id="warranty">
                  <rank>40</rank>
                </item>
                <item id="end_of_warranty">
                  <rank>50</rank>
                </item>
              </items>
            </item>
            <item id="fieldset:WarehouseDocument:warehouseInfo">
              <rank>20</rank>
              <items>
                <item id="org_id">
                  <rank>10</rank>
                </item>
                <item id="caller_id">
                  <rank>20</rank>
                </item>
                
                <item id="product_category_id">
                  <rank>30</rank>
                </item>
                <item id="product_id">
                  <rank>40</rank>
                </item>
                
                <item id="count">
                  <rank>50</rank>
                </item>
                <item id="inventory_id">
                  <rank>60</rank>
                </item>
                <item id="inventory_detail_id">
                  <rank>70</rank>
                </item>
              </items>
            </item>
            
            
            <item id="physical_device_list">
              <rank>140</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="vendor">
              <rank>5</rank>
            </item>
            <item id="invoice_serial">
              <rank>10</rank>
            </item>
            <item id="invoice_date">
              <rank>15</rank>
            </item>
            <item id="warranty">
              <rank>16</rank>
            </item>
            <item id="end_of_warranty">
              <rank>17</rank>
            </item>
            <item id="org_id">
              <rank>20</rank>
            </item>
            <item id="caller_id">
              <rank>30</rank>
            </item>
            <item id="product_category_id">
              <rank>50</rank>
            </item>
            <item id="product_id">
              <rank>60</rank>
            </item>
            
            <item id="count">
              <rank>80</rank>
            </item>
            <item id="inventory_id">
              <rank>100</rank>
            </item>
            <item id="inventory_detail_id">
              <rank>110</rank>
            </item>

          </items>
        </search>
        <list>
          <items>
            <item id="vendor">
              <rank>5</rank>
            </item>
            <item id="invoice_serial">
              <rank>10</rank>
            </item>
            <item id="invoice_date">
              <rank>15</rank>
            </item>
            <item id="warranty">
              <rank>16</rank>
            </item>
            <item id="end_of_warranty">
              <rank>17</rank>
            </item>
            <item id="product_category_id">
              <rank>50</rank>
            </item>
            <item id="product_id">
              <rank>60</rank>
            </item>
            <item id="count">
              <rank>80</rank>
            </item>
            <item id="inventory_id">
              <rank>100</rank>
            </item>
            <item id="inventory_detail_id">
              <rank>110</rank>
            </item>

          </items>
        </list>
      </presentation>
      <methods>
        <method id="OnInsert">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function OnInsert()
    {
      $this->Set('balance' , $this->Get('count'));

      $this->Set('created_at', time());
      $iNextId = MetaModel::GetNextKey(get_class($this));
      if ($this->Get('ref') == '')
      {
        $this->Set('ref' , 'WD-'.sprintf('%06d', $iNextId));
      }
      
      parent::OnInsert();

    }
  ]]></code>
        </method>
        <method id="AfterInsert">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function AfterInsert()
  {
     parent::AfterInsert();

    
    $ci = $this->Get('physical_device_type');
        
        $ciAtts = Metamodel::ListAttributeDefs($ci);
        $tt = MetaModel::GetZListItems($ci, 'details');
        foreach ($tt as $t => $v) {
          if (is_array($v))
      {
        foreach ($v as $key => $value) {
          foreach ($value as $subV) {
            if (isset($ciAtts[$subV]))
            {
              if (!$ciAtts[$subV]->IsNullAllowed())
              {
                $finalAtts[] = $subV;
               
              }
            }
          }
        }
        continue;
      }
          if (!is_array($v)){
            if (isset($ciAtts[$v]))
            {
              if (!$ciAtts[$v]->IsNullAllowed())
              {
                $finalAtts[]=$v;
              }
            }
          }
      }

    $aList = $finalAtts;

    if ($this->Get('count') <= 20)
    {
      for ($i=1; $i <= $this->Get('count'); $i++) { 
        //
        $oNewCi[$i] = MetaModel::NewObject($ci);
        $oNewRel[$i] = MetaModel::NewObject('lnkWarehouseDocToPhysicalDevice');
        foreach ($aList as $item) 
        {
          if($item=='org_id'){
            $oNewCi[$i]->Set('org_id' , $this->Get('org_id'));
            continue;
          }
          if($item =='name'){
            $oNewCi[$i]->Set($item , utils::ReadParam('ci_'.$item).'-'.$i);
            continue;
          }
          $oNewCi[$i]->Set($item , utils::ReadParam('ci_'.$item));
        }

            $oNewCi[$i]->Set('status' , 'stock');
            $wdID = $this->Get('id');
            $oNewCi[$i]->Set('warehouse_document_id' , $wdID);
            $oNewCi[$i]->Set('product_id' , $this->Get('product_id'));
            $oNewCi[$i]->Set('purchase_date' , $this->Get('invoice_date'));
            $oNewCi[$i]->Set('end_of_warranty' , $this->Get('end_of_warranty'));
            $pdID = $oNewCi[$i]->DBInsertNoReload();

            $oNewRel[$i]->Set('warehouse_document_id', $wdID);
            $oNewRel[$i]->Set('physical_device_id', $pdID);
            $oNewRel[$i]->DBInsertNoReload();
      }
    }
    else{

      
      
      $root_url = MetaModel::GetConfig()->Get('app_root_url');
      

      //preparing input data
      $id = $this->Get('id');
      $org_id = $this->Get('org_id');
      foreach ($aList as $key) {
        $params[$key] = utils::ReadParam('ci_'. $key);
      }
      $jParams = json_encode($params);

      $query = 'id='.$id;
      $query .= '&org_id='. $org_id;
      $query .= '&params='. $jParams;


      /** 
      | sending the input data
      | to the local queue app
      | -----------------------
      */

      // create curl resource
        $ch = curl_init();
        // set url
        curl_setopt($ch, CURLOPT_URL, $root_url."queue/public/?".$query);
        $fff = fopen("test_url.php","w");
    fwrite($fff,($root_url."queue/public/?".$query));
      fclose($fff);
        //return the transfer as a string
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0);
        // $output contains the output string
        $output = curl_exec($ch);
        // close curl resource to free up system resources
        curl_close($ch); 

    }

  }
  ]]></code>
        </method>
      </methods>
      
    </class>
    <class id="PhysicalDevice">
      <fields>
        <field id="warehouse_document_id" xsi:type="AttributeExternalKey" _delta="define" >
          <sql>warehouse_document_id</sql>
          <target_class>WarehouseDocument</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="warehouse_document_serial" xsi:type="AttributeExternalField" _delta="define">
          <extkey_attcode>warehouse_document_id</extkey_attcode>
          <target_attcode>invoice_serial</target_attcode>
        </field>
        <field id="product_id" xsi:type="AttributeExternalKey" _delta="define" >
          <sql>product_id</sql>
          <target_class>Product</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="product_title" xsi:type="AttributeExternalField" _delta="define">
          <extkey_attcode>product_id</extkey_attcode>
          <target_attcode>title</target_attcode>
        </field>
        <field id="ci_assignment_list" xsi:type="AttributeLinkedSetIndirect" _delta="define">
          <linked_class>lnkCiAssignmentToPhysicalDevice</linked_class>
          <ext_key_to_me>physical_device_id</ext_key_to_me>
          <count_min>0</count_min>
          <count_max>0</count_max>
          <ext_key_to_remote>ci_assignment_id</ext_key_to_remote>
          <duplicates/>
        </field>
        <field id="contact_id" xsi:type="AttributeExternalKey" _delta="define" >
          <sql>contact_id</sql>
          <target_class>Person</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="warehouse_document_id" _delta="define">
              <rank>120</rank>
            </item>
            <item id="product_id" _delta="define">
              <rank>130</rank>
            </item>
            <item id="ci_assignment_list" _delta="define">
              <rank>2</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="warehouse_document_id" _delta="define">
              <rank>120</rank>
            </item>
            <item id="product_id" _delta="define">
              <rank>130</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="warehouse_document_id" _delta="define">
              <rank>120</rank>
            </item>
            <item id="product_id" _delta="define">
              <rank>130</rank>
            </item>
          </items>
        </list>
      </presentation>
    </class>
    <class id="lnkCiAssignmentToPhysicalDevice" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <is_link>1</is_link>
        <category>bizmodel</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>lnkciassignmenttophysicaldevice</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="physical_device_id"/>
            <attribute id="ci_assignment_id"/>
          </attributes>
        </naming>
        <display_template/>
        <icon/>
        <reconciliation>
          <attributes>
            <attribute id="physical_device_id"/>
            <attribute id="ci_assignment_id"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="ci_assignment_id" xsi:type="AttributeExternalKey">
          <sql>ci_assignment_id</sql>
          <target_class>CiAssignment</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="physical_device_id" xsi:type="AttributeExternalKey">
          <sql>physical_device_id</sql>
          <target_class>PhysicalDevice</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
      </fields>
      <methods/>
      <presentation>
        <details>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </list>
      </presentation>
    </class>

    <class id="lnkWarehouseDocToPhysicalDevice" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <is_link>1</is_link>
        <category>bizmodel</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>lnkwarehousedoctophysicaldevice</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="physical_device_id"/>
            <attribute id="warehouse_document_id"/>
          </attributes>
        </naming>
        <display_template/>
        <icon/>
        <reconciliation>
          <attributes>
            <attribute id="physical_device_id"/>
            <attribute id="warehouse_document_id"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="warehouse_document_id" xsi:type="AttributeExternalKey">
          <sql>warehouse_document_id</sql>
          <target_class>WarehouseDocument</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="warehouse_document_serial" xsi:type="AttributeExternalField">
          <extkey_attcode>warehouse_document_id</extkey_attcode>
          <target_attcode>invoice_serial</target_attcode>
        </field>
        <field id="physical_device_id" xsi:type="AttributeExternalKey">
          <sql>physical_device_id</sql>
          <target_class>PhysicalDevice</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="physical_device_name" xsi:type="AttributeExternalField">
          <extkey_attcode>physical_device_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="warehouse_document_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="warehouse_document_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="warehouse_document_id">
              <rank>10</rank>
            </item>
            <item id="physical_device_id">
              <rank>20</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods/>
    </class>
    <class id="CiAssignment" _delta="define">
      <parent>FunctionalDocument</parent>
      <properties>
        <category>bizmodel,searchable</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>ci-assignment</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </naming>
        <display_template/>
        
        <reconciliation>
          <attributes>
            <attribute id="ref"/>
            <attribute id="ticket_id"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="date" xsi:type="AttributeDate">
          <always_load_in_tables>true</always_load_in_tables>
          <sql>date</sql>
          <default_value/>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="documents" xsi:type="AttributeLinkedSetIndirect">
          <linked_class>lnkDocumentToCiAssignment</linked_class>
          <ext_key_to_me>ci_assignment_id</ext_key_to_me>
          <ext_key_to_remote>document_id</ext_key_to_remote>
        </field>
        <field id="ticket_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Ticket]]></filter>
          <sql>ticket_id</sql>
          <target_class>Ticket</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="caller_id" xsi:type="AttributeExternalField">
          <extkey_attcode>ticket_id</extkey_attcode>
          <target_attcode>caller_id</target_attcode>
        </field>
        <field id="ci_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT PhysicalDevice WHERE product_id = :this->product_id AND (status = 'stock' OR id=:this->ci_id)]]></filter>
          <dependencies>
            <attribute id="product_id"/>
          </dependencies>
          <sql>ci_id</sql>
          <target_class>PhysicalDevice</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="ci_name" xsi:type="AttributeExternalField">
          <extkey_attcode>ci_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
        <field id="ci_2_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT PhysicalDevice WHERE product_id = :this->product_id AND (status = 'production' OR id=:this->ci_2_id) AND contact_id = :this->caller_id]]></filter>
          <dependencies>
            <attribute id="product_id"/>
            <attribute id="caller_id"/>
          </dependencies>
          <sql>ci_2_id</sql>
          <target_class>PhysicalDevice</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="ci_2_name" xsi:type="AttributeExternalField">
          <extkey_attcode>ci_2_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
        <field id="comment" xsi:type="AttributeText">
          <sql>comment</sql>
          <default_value></default_value>
          <is_null_allowed>true</is_null_allowed>
        </field>
        <field id="physical_device_list" xsi:type="AttributeLinkedSetIndirect">
          <linked_class>lnkCiAssignmentToPhysicalDevice</linked_class>
          <ext_key_to_me>ci_assignment_id</ext_key_to_me>
          <count_min>0</count_min>
          <count_max>0</count_max>
          <ext_key_to_remote>physical_device_id</ext_key_to_remote>
          <duplicates/>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="documents">
              <rank>1</rank>
            </item>
            <item id="col:col1">
              <rank>10</rank>
              <items>
                <item id="fieldset:CiAssignment:baseInfo">
                  <rank>10</rank>
                  <items>
                    <item id="date">
                      <rank>20</rank>
                    </item>
                    <item id="ticket_id">
                      <rank>40</rank>
                    </item>
                    <item id="caller_id">
                      <rank>45</rank>
                    </item>
                    <item id="product_category_id">
                      <rank>50</rank>
                    </item>
                    <item id="product_id">
                      <rank>60</rank>
                    </item>
                    
                  </items>
                </item>
              </items>
            </item>
            <item id="col:col2">
              <rank>20</rank>
              <items>
                <item id="fieldset:CiAssignment:delivered_ci">
                  <rank>10</rank>
                  <items>
                    <item id="ci_id">
                      <rank>10</rank>
                    </item>
                  </items>
                </item>
                <item id="fieldset:CiAssignment:returned_ci">
                  <rank>20</rank>
                  <items>
                    <item id="ci_2_id">
                      <rank>10</rank>
                    </item>
                    <item id="comment">
                      <rank>20</rank>
                    </item>
                  </items>
                </item>
              </items>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
            <item id="product_category_id">
              <rank>20</rank>
            </item>
            <item id="product_id">
              <rank>30</rank>
            </item>
            
          </items>
        </search>
        <list>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
            <item id="product_category_id">
              <rank>20</rank>
            </item>
            <item id="product_id">
              <rank>30</rank>
            </item>
            
          </items>
        </list>
      </presentation>
      <methods>
        
        <method id="OnInsert">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function OnInsert()
    {
      $iNextId = MetaModel::GetNextKey(get_class($this));
      if ($this->Get('ref') == '')
      {
        $this->Set('ref' , 'CA-'.sprintf('%06d', $iNextId));
      }
      if ($this->Get('ci_id') !='') {
        $this->Set('balance' , '-1');
      }
      if ($this->Get('ci_2_id') !='') {

          $oCUD = MetaModel::NewObject('CiUnassignment');
          $oCUD->Set('ci_id', $this->Get('ci_2_id'));
          $oCUD->Set('balance', '1');
          $oCUD->Set('ref', $this->Get('ref'));
          $oCUD->Set('ticket_id', $this->Get('ticket_id'));
          $oCUD->Set('product_category_id', $this->Get('product_category_id'));
          $oCUD->Set('product_id', $this->Get('product_id'));
          $oCUD->DBInsertNoReload();

      }
      parent::OnInsert();
    }
  ]]></code>
        </method>
        <method id="AfterInsert">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function AfterInsert()
    {
        parent::AfterInsert();
        

        
        $sCiClass = $this->Get('physical_device_type');

        if ($this->Get('ci_id') != ''){
          $iKey = $this->Get('ci_id');
          $oCI = Metamodel::GetObject($sCiClass, $iKey);
          $oCI->Set('status' , 'production');
          $oCI->Set('contact_id' , $this->Get('caller_id'));
          $oCI->Set('move2production' , time());
          $oCI->DBUpdate();

          $oNewRel = MetaModel::NewObject('lnkCiAssignmentToPhysicalDevice');
          $oNewRel->Set('physical_device_id', $this->Get('ci_id'));
          $oNewRel->Set('ci_assignment_id', $this->Get('id'));
          $oNewRel->DBInsertNoReload();
        }

        if ($this->Get('ci_2_id') != ''){
          $iKey = $this->Get('ci_2_id');
          $oCI = Metamodel::GetObject($sCiClass, $iKey);
          $oCI->Set('status' , 'stock');
          $oCI->Set('contact_id' , '');
          $oCI->DBUpdate();

          $oNewRel = MetaModel::NewObject('lnkCiAssignmentToPhysicalDevice');
          $oNewRel->Set('physical_device_id', $this->Get('ci_2_id'));
          $oNewRel->Set('ci_assignment_id', $this->Get('id'));
          $oNewRel->DBInsertNoReload();
        }

        $this->Set('created_at', time());
        
    }
  ]]></code>
        </method>
        <method id="AfterDelete">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function AfterDelete()
    {
        parent::AfterDelete();
        $sCiClass = $this->Get('physical_device_type');
        
        if ($this->Get('ci_id') != ''){
          $iKey = $this->Get('ci_id');
          $oCI = Metamodel::GetObject($sCiClass, $iKey);
          $oCI->Set('status' , 'stock');
          $oCI->DBUpdate();
        }

        if ($this->Get('ci_2_id') != ''){
          $iKey = $this->Get('ci_2_id');
          $oCI = Metamodel::GetObject($sCiClass, $iKey);

          $oCI->Set('status' , 'production');
          $oCI->DBUpdate();
        }
        

    }
  ]]></code>
        </method>
        <method id="UpdateObjectFromPostedForm">
          <static>false</static>
          <access>public</access>
          <type>Overload-cmdbAbstractObject</type>
          <code><![CDATA[
    public function UpdateObjectFromPostedForm($sFormPrefix = '', $aAttList = null, $aAttFlags = array())
    {
        
        $sCiClass = $this->Get('physical_device_type');
        $iKey = $this->Get('ci_id');
        if ($sCiClass!=''){
          $oCI = Metamodel::GetObject($sCiClass, $iKey);
          $oCI->Set('status' , 'stock');
          $oCI->DBUpdate();
        }
        parent::UpdateObjectFromPostedForm();
        

    }
  ]]></code>
        </method>
        <method id="AfterUpdate">
          <static>false</static>
          <access>protected</access>
          <type>Overload-DBObject</type>
          <code><![CDATA[
    protected function AfterUpdate()
    {
        parent::AfterUpdate();
        $sCiClass = $this->Get('physical_device_type');
        $iKey = $this->Get('ci_id');
        $oCI = Metamodel::GetObject($sCiClass, $iKey);

        $oCI->Set('status' , 'production');
        $oCI->DBUpdate();

    }
  ]]></code>
        </method>
      </methods>
    </class>
    <class id="Ticket">
      <fields>
        <field id="ci_assignment_list" xsi:type="AttributeLinkedSet" _delta="define">
          <linked_class>CiAssignment</linked_class>
          <ext_key_to_me>ticket_id</ext_key_to_me>
          <count_min>0</count_min>
          <count_max>0</count_max>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="ci_assignment_list"  _delta="define">
              <rank>165</rank>
            </item>
          </items>
        </details>
      </presentation>
    </class>
    <class id="UserRequest">
      <presentation>
        <details>
          <items>
            <item id="ci_assignment_list"  _delta="define">
              <rank>15</rank>
            </item>
          </items>
        </details>
      </presentation>
    </class>
    <class id="CiUnassignment" _delta="define">
      <parent>FunctionalDocument</parent>
      <properties>
        <category>bizmodel</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>ci-unassignment</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </naming>
        <display_template/>
        <reconciliation>
          <attributes>
            <attribute id="ref"/>
            <attribute id="ticket_id"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="ticket_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT Ticket]]></filter>
          <sql>ticket_id</sql>
          <target_class>Ticket</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_MANUAL</on_target_delete>
        </field>
        <field id="caller_id" xsi:type="AttributeExternalField">
          <extkey_attcode>ticket_id</extkey_attcode>
          <target_attcode>caller_id</target_attcode>
        </field>
        <field id="ci_id" xsi:type="AttributeExternalKey">
          <filter><![CDATA[SELECT PhysicalDevice WHERE product_id = :this->product_id AND (status = 'stock' OR id=:this->ci_id)]]></filter>
          <dependencies>
            <attribute id="product_id"/>
          </dependencies>
          <sql>ci_id</sql>
          <target_class>PhysicalDevice</target_class>
          <is_null_allowed>true</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="ci_name" xsi:type="AttributeExternalField">
          <extkey_attcode>ci_id</extkey_attcode>
          <target_attcode>name</target_attcode>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </details>
        <list>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </list>
        <search>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </search>
      </presentation>
      <methods/>
    </class>

    <class id="Warranty" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <category>bizmodel,searchable</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>warranties</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </naming>
        <display_template/>
        <reconciliation>
          <attributes>
            <attribute id="title"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="title" xsi:type="AttributeString">
          <sql>title</sql>
          <default_value />
          <is_null_allowed>false</is_null_allowed>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
          </items>
        </details>
        <list>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
          </items>
        </list>
        <search>
          <items>
            <item id="title">
              <rank>10</rank>
            </item>
          </items>
        </search>
      </presentation>
      <methods/>
    </class>




    <class id="FakeTicket" _delta="define">
      <parent>Ticket</parent>
      <properties>
        <category>bizmodel</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>fake-tickets</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </naming>
        <display_template/>
        <reconciliation>
          <attributes>
            <attribute id="ref"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </details>
        <list>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </list>
        <search>
          <items>
            <item id="ref">
              <rank>10</rank>
            </item>
          </items>
        </search>
      </presentation>
      <methods/>
    </class>


    <class id="lnkDocumentToCiAssignment" _delta="define">
      <parent>cmdbAbstractObject</parent>
      <properties>
        <is_link>1</is_link>
        <category>bizmodel</category>
        <abstract>false</abstract>
        <key_type>autoincrement</key_type>
        <db_table>lnkdocumenttociassignment</db_table>
        <db_key_field>id</db_key_field>
        <db_final_class_field/>
        <naming>
          <attributes>
            <attribute id="ci_assignment_id"/>
            <attribute id="document_id"/>
          </attributes>
        </naming>
        <display_template/>
        <icon/>
        <reconciliation>
          <attributes>
            <attribute id="ci_assignment_id"/>
            <attribute id="document_id"/>
          </attributes>
        </reconciliation>
      </properties>
      <fields>
        <field id="ci_assignment_id" xsi:type="AttributeExternalKey">
          <sql>ci_assignment_id</sql>
          <target_class>CiAssignment</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
        <field id="document_id" xsi:type="AttributeExternalKey">
          <sql>document_id</sql>
          <target_class>Document</target_class>
          <is_null_allowed>false</is_null_allowed>
          <on_target_delete>DEL_AUTO</on_target_delete>
        </field>
      </fields>
      <presentation>
        <details>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="document_id">
              <rank>20</rank>
            </item>
          </items>
        </details>
        <search>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="document_id">
              <rank>20</rank>
            </item>
          </items>
        </search>
        <list>
          <items>
            <item id="ci_assignment_id">
              <rank>10</rank>
            </item>
            <item id="document_id">
              <rank>20</rank>
            </item>
          </items>
        </list>
      </presentation>
      <methods/>
    </class>

    <class id="PhysicalDevice">
<fields>
<field id="brand_id" xsi:type="AttributeExternalKey">
          <is_null_allowed _delta="redefine">false</is_null_allowed>
        </field>
<field id="model_id" xsi:type="AttributeExternalKey">
          <is_null_allowed _delta="redefine">false</is_null_allowed>
        </field>
        <field id="effective_life" xsi:type="AttributeString">
          <is_null_allowed _delta="redefine">false</is_null_allowed>
        </field>
      </fields>
    </class>
    
  </classes>

  <menus>
    <menu id="WarehouseMgmt" xsi:type="MenuGroup" _delta="define">
      <rank>28</rank>
      <enable_class>ProductCategory</enable_class>
      <enable_action>UR_ACTION_READ | UR_ACTION_MODIFY</enable_action>
    </menu>
    <menu xsi:type="OQLMenuNode" id="ProductCategory" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>10</rank>
      <oql>SELECT ProductCategory</oql>
      <do_search>1</do_search>
    </menu>
    <menu id="NewProductCategory" xsi:type="NewObjectMenuNode" _delta="define">
      <rank>10</rank>
      <parent>ProductCategory</parent>
      <class>ProductCategory</class>
    </menu>
    <menu id="SearchProductCategory" xsi:type="SearchMenuNode" _delta="define">
      <rank>20</rank>
      <parent>ProductCategory</parent>
      <class>ProductCategory</class>
    </menu>
    <menu xsi:type="OQLMenuNode" id="Product" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>20</rank>
      <oql>SELECT Product</oql>
      <do_search>1</do_search>
    </menu>
    <menu id="NewProduct" xsi:type="NewObjectMenuNode" _delta="define">
      <rank>10</rank>
      <parent>Product</parent>
      <class>Product</class>
    </menu>
    <menu id="SearchProduct" xsi:type="SearchMenuNode" _delta="define">
      <rank>20</rank>
      <parent>Product</parent>
      <class>Product</class>
    </menu>
    <menu xsi:type="OQLMenuNode" id="Inventory" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>30</rank>
      <oql>SELECT Inventory</oql>
      <do_search>1</do_search>
    </menu>
    <menu xsi:type="OQLMenuNode" id="InventoryDetail" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>40</rank>
      <oql>SELECT InventoryDetail</oql>
      <do_search>1</do_search>
    </menu>
    <menu xsi:type="OQLMenuNode" id="WarehouseDocument" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>50</rank>
      <oql>SELECT WarehouseDocument</oql>
      <do_search>1</do_search>
    </menu>
    <menu xsi:type="OQLMenuNode" id="CiAssignment" _delta="define">
      <parent>WarehouseMgmt</parent>
      <rank>60</rank>
      <oql>SELECT CiAssignment</oql>
      <do_search>1</do_search>
    </menu>
    <menu id="Warehouse:Overview" xsi:type="DashboardMenuNode" _delta="define">
      <rank>0</rank>
      <parent>WarehouseMgmt</parent>
      <definition>
        <layout>DashboardLayoutTwoCols</layout>
        <title>UI:WarehouseMgmtMenuOverview:Title</title>
        <cells>
          <cell id="0">
            <rank>2</rank>
            <dashlets>
              <dashlet id="3" xsi:type="DashletGroupByTable">
                <rank>0</rank>
                <title>UI-WarehouseManagementOverview-OpenPhysicalByStatus</title>
                <query>SELECT PhysicalDevice WHERE status = "stock" </query>
                <group_by>product_id</group_by>
                <style>table</style>
              </dashlet>
            </dashlets>
          </cell>
        </cells>
      </definition>
    </menu>
  </menus>
  <user_rights>
    <groups>
      <group id="WarehouseMgmt" _delta="define">
        <classes>
          <class id="ProductCategory" />
          <class id="Product" />
          <class id="Inventory" />
          <class id="InventoryDetail" />
          <class id="WarehouseDocument" />
          <class id="CiAssignment" />
        </classes>
      </group>
      <group id="docs" _delta="define">
        <classes>
          <class id="WarehouseDocument" />
          <class id="CiAssignment" />
        </classes>
      </group>
      <group id="CiAssignment" _delta="define">
        <classes>
          <class id="CiAssignment" />
        </classes>
      </group>
    </groups>
    <profiles>
      <profile id="30" _delta="define">
        <name>Warehouse Manager</name>
        <description>Person in charge of products and CIs and thier relative assignments</description>
        <groups>
          <group id="WarehouseMgmt">
            <actions>
              <action id="action:write">allow</action>
              <action id="action:delete">allow</action>
              <action id="action:read">allow</action>
            </actions>
          </group>
          <group id="docs">
            <actions>
              <action id="action:write">allow</action>
              <action id="action:read">allow</action>
              <action id="action:delete">allow</action>
            </actions>
          </group>
          <group id="*">
            <actions>
              <action id="action:read">allow</action>
            </actions>
          </group>
          <group id="Configuration">
            <actions>
              <action id="action:write">allow</action>
              <action id="action:read">allow</action>
              <action id="action:delete">deny</action>
            </actions>
          </group>
          <group id="UserLogin">
            <actions>
              <action id="action:write">allow</action>
              <action id="action:read">allow</action>
              <action id="action:delete">allow</action>
            </actions>
          </group>
        </groups>
      </profile>
      <profile id="5">
        <group id="CiAssignment" _delta="define">
            <action id="action:write">allow</action>
            <action id="action:delete">allow</action>
            <action id="action:read">allow</action>
          <actions>
          </actions>
        </group>
      </profile>
    </profiles>
  </user_rights>
  <module_designs>
  </module_designs>






  <classes>
    <class id="NetworkDevice"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Server"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Rack"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Enclosure"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="PowerSource"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="PDU"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="PC"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Printer"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Phone"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="MobilePhone"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="IPPhone"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Tablet"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="Peripheral"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="StorageSystem"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="SANSwitch"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="TapeLibrary"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class><class id="NAS"><presentation><details><items><item id="ci_assignment_list" _delta="define"><rank>1.5</rank></item><item id="warehouse_document_id" _delta="define"><rank>500</rank></item><item id="product_id" _delta="define"><rank>501</rank></item></items></details></presentation></class>
  </classes>
</itop_design>
